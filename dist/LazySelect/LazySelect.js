"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,require("core-js/modules/web.dom-collections.iterator.js"),require("core-js/modules/es.promise.js"),require("./LazySelect.css");var _react=_interopRequireWildcard(require("react")),_TagsInput=_interopRequireDefault(require("../TagsInput/TagsInput")),_HTTPHelper=require("../Common/HTTPHelper"),_ScrollHelper=require("../Common/ScrollHelper");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _getRequireWildcardCache(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(_getRequireWildcardCache=function(a){return a?c:b})(a)}function _interopRequireWildcard(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=_getRequireWildcardCache(b);if(c&&c.has(a))return c.get(a);var d={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a)if("default"!=f&&Object.prototype.hasOwnProperty.call(a,f)){var g=e?Object.getOwnPropertyDescriptor(a,f):null;g&&(g.get||g.set)?Object.defineProperty(d,f,g):d[f]=a[f]}return d.default=a,c&&c.set(a,d),d}function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}const LazySelect=/*#__PURE__*/_react.default.memo(a=>{const{ApiURL:b,UniqueKey:c,DisplayBy:d,PlaceHolder:e="Select Items ...",useQueryParams:f=!1,useBodyParams:g=!1,RequestMethod:h="post",ExistingRequestParams:i={},ExistingRequestHeaders:j={},PageSize:k=10,SearchRequestParamName:l="search",StartFromRequestParamName:m="from",PageSizeRequestParamName:n="size",ResponseResultsHierarchy:o="",DisplayShowMoreOption:p=!0,MaximunOptionToShow:q=-1,DisplayShowMoreOptionCallBack:r=()=>{},SelectionChangedCallBack:s=()=>{},IsMulti:t=!0,ShowTags:u=!0}=a;if(!c)throw new Error("the name of the UniqueKey of your data must be provided");if(!b)throw new Error("ApiURL for your data must be provided");const[v,w]=(0,_react.useState)(""),[x,y]=(0,_react.useState)(!1),[z,A]=(0,_react.useState)(!1),[B,C]=(0,_react.useState)(!1),[D,E]=(0,_react.useState)(!1),[F,G]=(0,_react.useState)(!1),[H,I]=(0,_react.useState)([]),[J,K]=(0,_react.useState)([]),[L,M]=(0,_react.useState)(1),N=(0,_react.useRef)(null),O=()=>{let a=b,c={};if(f){for(const b in a+="?",i)a+="".concat(b,"=").concat(i[b],"&");a+="".concat(l,"=").concat(v,"&"),a+="".concat(m,"=").concat(L,"&"),a+="".concat(n,"=").concat(k)}else g&&(c=_objectSpread({},i),c[l]=v,c[m]=L,c[n]=k);return{method:h,baseURL:a,data:c,headers:j}},P=(0,_react.useRef)(O()),Q=async function(){let a=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0];C(!0),E(!1);const b=O();if(console.log("Request Info ",b," previous request info ",P.current),a||b.data[m]!==P.current.data[m]||b.data[l]!==P.current.data[l]){console.log("Request Info ",b);let a=await(0,_HTTPHelper.getDataList)(b.method,b.baseURL,b.data,b.headers);if(a.success){let b=0;I(c=>{const d=[...c,...(0,_HTTPHelper.parseResponseResultsHierarchy)(o,a.data)];return b=d.length,d}),M(b)}else E(!0);P.current=b}x&&y(!1),z&&A(!1),C(!1)};(0,_react.useEffect)(()=>{Q(!0)},[]),(0,_react.useEffect)(()=>{x&&(console.log("useEffect for scroll"),Q())},[x]),(0,_react.useEffect)(()=>{const a=setTimeout(()=>{z&&(I([]),console.log("useEffect for search"),Q())},700);return()=>clearTimeout(a)},[v]);const R=(a,b)=>{t?K(d=>a?[...d,b]:[...d.filter(a=>a[c]!==b[c])]):K(()=>a?[b]:[])},S=a=>{M(1),a.target.value!==v&&(w(a.target.value),A(!0))},T=(0,_react.useRef)(!1);(0,_react.useEffect)(()=>{s(J)},[J]);return/*#__PURE__*/_react.default.createElement("div",{className:"lazyselect"},/*#__PURE__*/_react.default.createElement("div",{className:"lazyselect-select-wrapper"},/*#__PURE__*/_react.default.createElement("div",{className:"lazyselect-select"},/*#__PURE__*/_react.default.createElement("div",{onClick:a=>{a.target.classList.contains("tag-close-icon")||(F?(G(!1),w("")):G(!0))},className:F?"lazyselect-select-output active":"lazyselect-select-output"},(()=>{if(t){if(u)return/*#__PURE__*/_react.default.createElement(_TagsInput.default,{uniqueKey:c,displayBy:d,placeHolder:e,selectedDataList:J,renderedSelectedDataList:0>=q?J:J.slice(0,q),onSearchChange:S,searchValue:v,handleOptionSelectedUnselected:R,displayShowMoreOption:p,maximunOptionToShow:q,displayShowMoreOptionCallBack:r});}else if(J[0])return/*#__PURE__*/_react.default.createElement("div",{className:"tags-input"},/*#__PURE__*/_react.default.createElement("input",{type:"text",value:v,onChange:S,placeholder:J[0][d]}));return/*#__PURE__*/_react.default.createElement("div",{className:"tags-input"},/*#__PURE__*/_react.default.createElement("input",{type:"text",onChange:S,value:v,placeholder:e}))})(),/*#__PURE__*/_react.default.createElement("div",{className:"icon",style:{lineHeight:F?"49px":"46px"}},/*#__PURE__*/_react.default.createElement("i",{className:"arrow ".concat(F?"up":"down")}))),/*#__PURE__*/_react.default.createElement("div",{ref:N,className:F?"lazyselect-select-box show":"lazyselect-select-box",onScroll:()=>{const a=N.current,b=(0,_ScrollHelper.isElementAtBottom)(a,1);console.log("at bottom",b,"prev at bottom ",T.current),b&&b!==T.current&&(console.log("set scrolled",b),y(!0)),T.current=b}},/*#__PURE__*/_react.default.createElement("div",{className:"lazyselectcheckbox-list-container"},(()=>H.map((a,b)=>{let e=J.find(b=>b[c]===a[c]),f=!!e;return/*#__PURE__*/_react.default.createElement("div",{key:b,className:"lazyselectcheckbox-container"+(f?" lazyselectcheckbox-active":"")},/*#__PURE__*/_react.default.createElement("input",{type:"checkbox",className:"lazyselectcheckbox",onChange:b=>R(b.target.checked,a),checked:f}),/*#__PURE__*/_react.default.createElement("label",{className:"lazyselectcheckbox-label"},a[d]))}))()),B&&/*#__PURE__*/_react.default.createElement("div",{className:"lazyselect-select-buttons"},"Loading ...."),D&&/*#__PURE__*/_react.default.createElement("div",{className:"lazyselect-select-buttons"},"Somthing went wrong!.")))))});var _default=LazySelect;exports.default=_default;