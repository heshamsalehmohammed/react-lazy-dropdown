"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,require("core-js/modules/web.dom-collections.iterator.js"),require("core-js/modules/es.promise.js"),require("core-js/modules/es.string.trim.js"),require("./LazySelect.css");var _react=_interopRequireWildcard(require("react")),_TagsInput=_interopRequireDefault(require("../TagsInput/TagsInput")),_HTTPHelper=require("../Common/HTTPHelper"),_reactInfiniteScrollComponent=_interopRequireDefault(require("react-infinite-scroll-component"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _getRequireWildcardCache(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(_getRequireWildcardCache=function(a){return a?c:b})(a)}function _interopRequireWildcard(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=_getRequireWildcardCache(b);if(c&&c.has(a))return c.get(a);var d={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a)if("default"!=f&&Object.prototype.hasOwnProperty.call(a,f)){var g=e?Object.getOwnPropertyDescriptor(a,f):null;g&&(g.get||g.set)?Object.defineProperty(d,f,g):d[f]=a[f]}return d.default=a,c&&c.set(a,d),d}function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}const LazySelect=/*#__PURE__*/_react.default.memo(a=>{const{ApiURL:b,UniqueKey:c,DisplayBy:d,PlaceHolder:e="Select Items ...",useQueryParams:f=!1,useBodyParams:g=!1,RequestMethod:h="post",ExistingRequestParams:i={},ExistingRequestHeaders:j={},PageSize:k=10,SearchRequestParamName:l="search",StartFromRequestParamName:m="from",PageSizeRequestParamName:n="size",ResponseResultsHierarchy:o="",DisplayShowMoreOption:p=!0,MaximunOptionToShow:q=-1,DisplayShowMoreOptionCallBack:r=()=>{},SelectionChangedCallBack:s=()=>{},IsMulti:t=!0,ShowTags:u=!0}=a;if(!c)throw new Error("the name of the UniqueKey of your data must be provided");if(!b)throw new Error("ApiURL for your data must be provided");const[v,w]=(0,_react.useState)(""),[x,y]=(0,_react.useState)(!1),[z,A]=(0,_react.useState)(!1),[B,C]=(0,_react.useState)(!1),[D,E]=(0,_react.useState)(!1),[F,G]=(0,_react.useState)([]),[H,I]=(0,_react.useState)([]),[J,K]=(0,_react.useState)(1),L=async()=>{A(!0),C(!1);const a=M();let b=await(0,_HTTPHelper.getDataList)(a.method,a.baseURL,a.data,a.headers);if(b.success){let a=0;G(c=>{const d=[...c,...N((0,_HTTPHelper.parseResponseResultsHierarchy)(o,b.data))];return a=d.length,d}),K(a)}else C(!0);A(!1)};(0,_react.useEffect)(()=>{L()},[]),(0,_react.useEffect)(()=>{(""!==v.trim()||x)&&(L(),x&&y(!1))},[v,x]);const M=()=>{let a=b,c={};if(f){for(const b in a+="?",i)a+="".concat(b,"=").concat(i[b],"&");a+="".concat(l,"=").concat(v,"&"),a+="".concat(m,"=").concat(J,"&"),a+="".concat(n,"=").concat(k)}else g&&(c=_objectSpread({},i),c[l]=v,c[m]=J,c[n]=k);return{method:h,baseURL:a,data:c,headers:j}},N=a=>{var b;return null!==(b=null===a||void 0===a?void 0:a.map(a=>_objectSpread(_objectSpread({},a),{},{isSelected:!1})))&&void 0!==b?b:[]},O=(a,b)=>{t?I(d=>a?[...d,b]:[...d.filter(a=>a[c]!==b[c])]):I(()=>a?[b]:[])},P=a=>{K(1),G([]),a.target.value!==v&&w(a.target.value)};(0,_react.useEffect)(()=>{s(H)},[H]);return/*#__PURE__*/_react.default.createElement("div",{className:"lazyselect"},/*#__PURE__*/_react.default.createElement("div",{className:"lazyselect-select-wrapper"},/*#__PURE__*/_react.default.createElement("div",{className:"lazyselect-select"},/*#__PURE__*/_react.default.createElement("div",{onClick:()=>{D?(E(!1),w("")):E(!0)},className:D?"lazyselect-select-output active":"lazyselect-select-output"},(()=>{if(t){if(u)return/*#__PURE__*/_react.default.createElement(_TagsInput.default,{uniqueKey:c,displayBy:d,placeHolder:e,selectedDataList:H,renderedSelectedDataList:0>=q?H:H.slice(0,q),onSearchChange:P,searchValue:v,handleOptionSelectedUnselected:O,displayShowMoreOption:p,maximunOptionToShow:q,displayShowMoreOptionCallBack:r});}else if(H[0])return/*#__PURE__*/_react.default.createElement("div",{className:"tags-input"},/*#__PURE__*/_react.default.createElement("input",{type:"text",value:v,onChange:P,placeholder:H[0][d]}));return/*#__PURE__*/_react.default.createElement("div",{className:"tags-input"},/*#__PURE__*/_react.default.createElement("input",{type:"text",onChange:P,value:v,placeholder:e}))})(),/*#__PURE__*/_react.default.createElement("div",{className:"icon",style:{lineHeight:D?"49px":"46px"}},/*#__PURE__*/_react.default.createElement("i",{className:"arrow ".concat(D?"up":"down")}))),/*#__PURE__*/_react.default.createElement("div",{className:D?"lazyselect-select-box show":"lazyselect-select-box"},/*#__PURE__*/_react.default.createElement("div",{className:"lazyselectcheckbox-list-container"},/*#__PURE__*/_react.default.createElement(_reactInfiniteScrollComponent.default,{dataLength:500,next:L,hasMore:!0},(()=>F.map((a,b)=>{let e=H.find(b=>b[c]===a[c]),f=!!e;return/*#__PURE__*/_react.default.createElement("div",{key:b,className:"lazyselectcheckbox-container"+(f?" lazyselectcheckbox-active":"")},/*#__PURE__*/_react.default.createElement("input",{type:"checkbox",className:"lazyselectcheckbox",onChange:b=>O(b.target.checked,a),checked:f}),/*#__PURE__*/_react.default.createElement("label",{className:"lazyselectcheckbox-label"},a[d]))}))())),z&&/*#__PURE__*/_react.default.createElement("div",{className:"lazyselect-select-buttons"},"Loading ...."),B&&/*#__PURE__*/_react.default.createElement("div",{className:"lazyselect-select-buttons"},"Somthing went wrong!.")))))});var _default=LazySelect;exports.default=_default;