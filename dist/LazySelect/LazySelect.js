"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,require("core-js/modules/web.dom-collections.iterator.js"),require("core-js/modules/es.promise.js"),require("core-js/modules/es.string.includes.js"),require("./LazySelect.css");var _react=_interopRequireWildcard(require("react")),_reactDom=_interopRequireDefault(require("react-dom")),_TagsInput=_interopRequireDefault(require("../TagsInput/TagsInput")),_HTTPHelper=require("../Common/HTTPHelper"),_ScrollHelper=require("../Common/ScrollHelper"),_LogHelper=_interopRequireDefault(require("../Common/LogHelper")),_CommonHelper=require("../Common/CommonHelper"),_LazyOption=_interopRequireDefault(require("./LazyOption")),_uuid=require("uuid");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _getRequireWildcardCache(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(_getRequireWildcardCache=function(a){return a?c:b})(a)}function _interopRequireWildcard(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=_getRequireWildcardCache(b);if(c&&c.has(a))return c.get(a);var d={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a)if("default"!=f&&Object.prototype.hasOwnProperty.call(a,f)){var g=e?Object.getOwnPropertyDescriptor(a,f):null;g&&(g.get||g.set)?Object.defineProperty(d,f,g):d[f]=a[f]}return d.default=a,c&&c.set(a,d),d}function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}const LazySelect=/*#__PURE__*/_react.default.memo(a=>{var b;const{ApiURL:c,UniqueKey:d,DisplayBy:e,Filterable:f=!0,PlaceHolder:g="Select Items ...",AxiosInstance:h=null,useQueryParams:i=!1,useBodyParams:j=!1,RequestMethod:k="post",ExistingRequestParams:l={},ExistingRequestHeaders:m={},usePathParams:n=!1,PathParameterArrangement:o=[],PageSize:p=10,useStartFromApproach:q=!0,usePageNumberApproach:r=!1,InitialStartFromOrPageNumber:s=1,SearchRequestParamName:t="search",StartFromRequestParamName:u="from",PageSizeRequestParamName:v="size",ResponseResultsHierarchy:w="",DisplayCheckBoxForOptions:x=!0,DisplayShowMoreOption:y=!0,MaximunOptionToShow:z=1,DisplayShowMoreOptionCallBack:A=()=>{},SelectionChangedCallBack:B=()=>{},SelectedDataList:C=[],IsMulti:D=!0,DisplayTags:E=!0,Virtualized:F=!1,numVisibleItems:G=10,itemheight:H=36.4,OptionsBoxHeight:I=250,OpenOnRendering:J=!1,AlwaysOpenMode:K=!1,PerformCustomLoginOnOption:L=null,OnDropDownClosed:M=()=>{},RenderOptionComponent:N=null,RenderTagComponent:O=null,RenderInputComponent:P=null,RenderLimitComponent:Q=null,OnInputPasteHandler:R=()=>{},ForceCloseDropDown:S=!1,SetForceCloseDropDown:T=null,DisplayUnselectAllButton:U=!0,SelectAllOptions:V=!1,ClosePopupAfterSelectionForNotMulti:W=!1,scrollThreshold:X=.8,ShowSelectAllCheckBoxForMulti:Y=!1,SelectAllText:Z="Select All"}=a;if(!d)throw new Error("the name of the UniqueKey of your data must be provided");if(!c)throw new Error("ApiURL for your data must be provided");const $=(0,_uuid.v4)(),[_,aa]=(0,_react.useState)(""),[ba,ca]=(0,_react.useState)(!1),[da,ea]=(0,_react.useState)(!1),[fa,ga]=(0,_react.useState)(!1),[ha,ia]=(0,_react.useState)(!1),[ja,ka]=(0,_react.useState)(!1),[la,ma]=(0,_react.useState)(!1),[na,oa]=(0,_react.useState)([]),[pa,qa]=(0,_react.useState)(C),[ra,sa]=(0,_react.useState)(!0),[ta,ua]=(0,_react.useState)(s),[va,wa]=(0,_react.useState)(-1),[xa,ya]=(0,_react.useState)({start:0,end:G}),za=(0,_react.useRef)(null),Aa=(0,_react.useRef)(null),Ba=(0,_react.useRef)(null),Ca=(0,_react.useRef)(null),Da=function(){let a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null,b=c,d={};if(i){for(const a in b+="?",l)b+="".concat(a,"=").concat(l[a],"&");b+="".concat(t,"=").concat(_,"&"),b+="".concat(u,"=").concat(null==a?ta:a,"&"),b+="".concat(v,"=").concat(p)}else if(n){const c=_objectSpread(_objectSpread({},(0,_CommonHelper.flattenObject)(l)),{},{[t]:_,[u]:null==a?ta:a,[v]:p});o.forEach(a=>{c.hasOwnProperty(a)&&(b+="/".concat(c[a]))})}else j&&(d=_objectSpread({},l),d[t]=_,d[u]=null==a?ta:a,d[v]=p);return{method:k,baseURL:b,data:d,headers:m}},Ea=(0,_react.useRef)(Da(null)),Fa=async function(){let a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;ga(!0),ia(!1);const b=Da(a);if(_LogHelper.default.LogMessage("Request Info FROM",b.data[u]),_LogHelper.default.LogMessage("previous request info FROM",Ea.current.data[u]),b.data[u]===s||b.data[u]!==Ea.current.data[u]){let a=await(0,_HTTPHelper.getDataList)(h,b.method,b.baseURL,b.data,b.headers);if(a.success){let b=s;oa(c=>{var e,f,g;let h=(0,_HTTPHelper.parseResponseResultsHierarchy)(w,a.data);if(null!=L){var i;h=null===(i=h)||void 0===i?void 0:i.map((a,b)=>L(a,b,b+c.length))}const j=null===c||void 0===c?void 0:c.map(a=>a[d]),k=null!==(e=null===(f=h)||void 0===f?void 0:f.filter(a=>j.includes(a[d])))&&void 0!==e?e:[];if(0<k.length){var l,m;_LogHelper.default.LogWarning("there is some duplication in the data, we will remove the duplicated options for you, but you need to fix this issue, the duplicated data are:"),_LogHelper.default.LogWarning(k),h=null!==(l=null===(m=h)||void 0===m?void 0:m.filter(a=>!j.includes(a[d])))&&void 0!==l?l:[]}const n=[...(null!==c&&void 0!==c?c:[]),...(null!==(g=h)&&void 0!==g?g:[])];return b=0===n.length?s:n.length,n}),ua(a=>{let c=s;return q&&(c=b+s),r&&(c=++a),c})}else ia(!0);Ea.current=b}ba&&(ca(!1),$a(za.current)),da&&ea(!1),la&&ma(!1),ga(!1)};(0,_react.useEffect)(()=>{la&&(ua(s),oa([]),Fa(s))},[la]),(0,_react.useEffect)(()=>{ba&&(Za(za.current),Fa())},[ba]),(0,_react.useEffect)(()=>{fa?sa(!0):ja&&sa(!1)},[fa]),(0,_react.useEffect)(()=>{if(!ra){var a;null===Ca||void 0===Ca||null===(a=Ca.current)||void 0===a?void 0:a.focus()}},[ra]),(0,_react.useEffect)(()=>{const a=setTimeout(()=>{da&&(ua(s),oa([]),Fa(s))},500);return()=>clearTimeout(a)},[_]);const Ga=(0,_react.useCallback)((a,b)=>{D?qa(c=>a?[...c,b]:[...c.filter(a=>a[d]!==b[d])]):qa(()=>a?(aa(b[e]),W&&Ma(),[b]):(aa(""),[]))}),Ha=()=>{qa(()=>(D||aa(""),[]))},Ia=()=>{qa(a=>[...a,...na])},Ja=(a,b)=>{let c=b.find(b=>b[d]===a[d]);return!!c},Ka=a=>{a.target.value!==_&&(aa(a.target.value),ea(!0))},La=()=>{ka(!0),ma(!0),sa(!1)},Ma=()=>{ka(!1),aa(""),ua(s),oa([]),sa(!0),M(pa)},Na=()=>{ja?Ma():La()};(0,_react.useEffect)(()=>{(J||K)&&Na()},[J,K]);const Oa=a=>{let b=Math.trunc(a.scrollTop/H);b=b-G>=na.length?b-G:b,b!==xa.start&&ya({start:b,end:b+G>=na.length?na.length-1:b+G})},Pa=(0,_react.useRef)(!1),Qa=()=>{const a=za.current;F&&Oa(a);const b=(0,_ScrollHelper.isElementAtBottom)(a,X);b&&b!==Pa.current&&ca(!0),Pa.current=b},Ra=(0,_react.useRef)(!0);(0,_react.useLayoutEffect)(()=>Ra.current?void(Ra.current=!1):void(B(pa),Sa.current=pa.map(a=>a[d]).join(",")),[pa]);const Sa=(0,_react.useRef)(null);(0,_react.useEffect)(()=>{const a=C.map(a=>a[d]).join(",");a!=Sa.current&&(Sa.current=a,qa(C))},[C]);const Ta=(0,_react.useRef)(!0);(0,_react.useLayoutEffect)(()=>Ta.current?void(Ta.current=!1):void(V?D&&Ia():Ha()),[V]);const Ua=()=>{const a=pa.map(a=>a[d]);return na.every(b=>a.includes(b[d]))},Va=a=>{_LogHelper.default.LogMessage("from key down",na);let b=-1;if(0!==na.length)if(38===a.keyCode&&0<va)wa(a=>(b=a-1,b)),Wa();else if(40===a.keyCode&&va<na.length-1)wa(a=>(b=a+1,b)),Wa();else if(13===a.keyCode){var c;let a=_objectSpread({},na[va]),b=null!==(c=pa.find(b=>b[d]===a[d]))&&void 0!==c&&c;Ga(!b,a)}},Wa=()=>{Aa.current&&Aa.current.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})},Xa=F?{height:na.length*H,minHeight:na.length*H}:{};let Ya=null===(b=Ba.current)||void 0===b?void 0:b.getBoundingClientRect();(0,_react.useEffect)(()=>(document.addEventListener("keydown",Va),()=>{document.removeEventListener("keydown",Va)})),(0,_react.useEffect)(()=>{S&&(Ma(),T(!1))},[S]);const Za=a=>{_LogHelper.default.LogMessage("scroll locked");var b=a.scrollTop;a.onscroll=()=>{a.scrollTop=b}},$a=a=>{a.onscroll=Qa};return/*#__PURE__*/_react.default.createElement("div",{className:"lazyselect-select",ref:Ba},/*#__PURE__*/_react.default.createElement("div",{onClick:K?()=>{}:a=>{(a.target.classList.contains("icon")||a.target.classList.contains("lazyselect-select-output")||a.target.classList.contains("arrow"))&&!a.target.classList.contains("unselect-all")&&Na()},className:ja?"lazyselect-select-output active":"lazyselect-select-output"},(()=>{if(D)return/*#__PURE__*/_react.default.createElement(_TagsInput.default,{uniqueKey:d,displayBy:e,Filterable:f,placeHolder:g,selectedDataList:pa,renderedSelectedDataList:0>=z?pa:pa.slice(0,z),onSearchChange:Ka,searchValue:_,handleOptionSelectedUnselected:Ga,displayShowMoreOption:y,maximunOptionToShow:z,displayShowMoreOptionCallBack:A,tagsInputDisabled:ra,RenderTagComponent:O,RenderLimitComponent:Q,RenderInputComponent:P,OnInputPasteHandler:R/* handleKeyDown={handleKeyDown} */,DisplayTags:E});return pa[0]?/*#__PURE__*/_react.default.createElement("div",{className:"tags-input"},null==P?/*#__PURE__*/_react.default.createElement("input",{ref:Ca,autoFocus:!0,disabled:ra||!f,type:"text",value:_,onChange:Ka,placeholder:pa[0][e],title:pa[0][e],onPaste:R/* onKeyDown={handleKeyDown} */}):P({ref:Ca,disabled:ra||!f,type:"text",value:_,onChange:Ka,placeholder:pa[0][e],title:pa[0][e]/* onKeyDown: handleKeyDown, */})):/*#__PURE__*/_react.default.createElement("div",{className:"tags-input"},null==P?/*#__PURE__*/_react.default.createElement("input",{ref:Ca,autoFocus:!0,disabled:ra||!f,type:"text",onChange:Ka,value:_,placeholder:g,onPaste:R/* onKeyDown={handleKeyDown} */}):P({ref:Ca,disabled:ra||!f,type:"text",onChange:Ka,value:_,placeholder:g/* onKeyDown: handleKeyDown, */}))})(),U&&/*#__PURE__*/_react.default.createElement("div",{style:{fontSize:"larger",fontWeight:"bold"},className:"unselect-all icon",onClick:Ha},"\xD7"),!K&&/*#__PURE__*/_react.default.createElement("div",{className:"icon"},/*#__PURE__*/_react.default.createElement("i",{className:"arrow ".concat(ja?"up":"down")}))),ja&&/*#__PURE__*/_reactDom.default.createPortal(/*#__PURE__*/_react.default.createElement("div",{ref:za,className:ja?"lazyselect-select-box show":"lazyselect-select-box",onScroll:Qa,style:{width:Ya.width,minWidth:Ya.width,height:I}},D&&Y&&0<na.length&&/*#__PURE__*/_react.default.createElement("div",{className:"lazyselect-selectall-container"},/*#__PURE__*/_react.default.createElement("div",{className:"selectall-checkbox"},/*#__PURE__*/_react.default.createElement("input",{type:"checkbox",onChange:()=>{Ua()?Ha():Ia()},className:"lazyselect-selectall-input lazyselectcheckbox",title:"Select All",checked:Ua()}),/*#__PURE__*/_react.default.createElement("label",null,Z))),/*#__PURE__*/_react.default.createElement("div",{className:"lazyselectcheckbox-list-container",style:Xa},(()=>na.map((a,b)=>{if(F&&!(b>=xa.start&&b<=xa.end))return null;let c=Ja(a,pa),d=va===b;return null==N?/*#__PURE__*/_react.default.createElement(_LazyOption.default,{InstanceId:$,key:b,index:b,oRef:d?Aa:null,id:"lazyselectcheckbox-container-".concat($,"-").concat(b),setCursor:wa,optionSelected:c,optionActive:d,DisplayCheckBoxForOptions:x,handleOptionSelectedUnselected:Ga,value:a,DisplayBy:e,itemheight:H,Virtualized:F,FirstVirtualOption:!!F&&b===xa.start}):N({key:b,index:b,ref:d?Aa:null,id:"lazyselectcheckbox-container-".concat($,"-").concat(b),setCursor:wa,optionSelected:c,optionActive:d,DisplayCheckBoxForOptions:x,handleOptionSelectedUnselected:Ga,optionValue:a,DisplayBy:e,itemheight:H,Virtualized:F,FirstVirtualOption:!!F&&b===xa.start})}))()),fa&&/*#__PURE__*/_react.default.createElement("div",{className:"lazyselect-select-buttons"},"Loading ...."),ha&&/*#__PURE__*/_react.default.createElement("div",{className:"lazyselect-select-buttons"},"Somthing went wrong!, Check your server!"),!fa&&!ha&&0===na.length&&/*#__PURE__*/_react.default.createElement("div",{className:"lazyselect-select-buttons"},"No Items Found!..")),Ba.current))});var _default=LazySelect;exports.default=_default;